{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["'use strict'\n\nconst React = require('react')\nconst PropTypes = require('prop-types')\n\nconst CanvasSize = 16\nlet linkEl\n\nconst drawAlert = (context, { alertCount, fillColor, text, textColor }) => {\n  context.font = 'bold 10px arial'\n  const Padding = 3\n\n  const w = context.measureText(text).width + Padding\n  const x = CanvasSize - w\n  const y = CanvasSize / 2 - Padding\n  const h = Padding + CanvasSize / 2\n  const r = Math.min(w / 2, h / 2)\n\n  context.beginPath()\n  context.moveTo(x + r, y)\n  context.arcTo(x + w, y, x + w, y + h, r)\n  context.arcTo(x + w, y + h, x, y + h, r)\n  context.arcTo(x, y + h, x, y, r)\n  context.arcTo(x, y, x + w, y, r)\n  context.closePath()\n  context.fillStyle = fillColor\n  context.fill()\n  context.fillStyle = textColor\n  context.textBaseline = 'bottom'\n  context.textAlign = 'right'\n  context.fillText(text, CanvasSize - Padding / 2, CanvasSize)\n}\n\nfunction drawIcon({\n  alertCount,\n  alertFillColor,\n  alertTextColor,\n  callback,\n  renderOverlay,\n  url: src,\n}) {\n  const img = document.createElement('img')\n  img.crossOrigin = 'Anonymous'\n  img.onload = function () {\n    const canvas = document.createElement('canvas')\n    canvas.width = CanvasSize\n    canvas.height = CanvasSize\n\n    const context = canvas.getContext('2d')\n    context.clearRect(0, 0, img.width, img.height)\n    context.drawImage(img, 0, 0, canvas.width, canvas.height)\n\n    if (alertCount) {\n      drawAlert(context, {\n        fillColor: alertFillColor,\n        textColor: alertTextColor,\n        text: alertCount,\n      })\n    }\n\n    if (renderOverlay) {\n      renderOverlay(canvas, context)\n    }\n\n    callback(context.canvas.toDataURL())\n  }\n  img.src = src\n}\n\nclass Favicon extends React.Component {\n  static displayName = 'Favicon'\n\n  static mountedInstances = []\n\n  static getActiveInstance() {\n    return Favicon.mountedInstances[Favicon.mountedInstances.length - 1]\n  }\n\n  static draw() {\n    if (typeof document === 'undefined') return\n\n    var activeInstance = Favicon.getActiveInstance()\n    if (typeof linkEl === 'undefined') {\n      var head = document.getElementsByTagName('head')[0]\n      linkEl = document.createElement('link')\n      linkEl.type = 'image/x-icon'\n      linkEl.rel = 'icon'\n\n      // remove existing favicons\n      var links = head.getElementsByTagName('link')\n      for (var i = links.length; --i >= 0; ) {\n        if (\n          /\\bicon\\b/i.test(links[i].getAttribute('rel')) &&\n          !activeInstance.props.keepIconLink(links[i])\n        ) {\n          head.removeChild(links[i])\n        }\n      }\n\n      head.appendChild(linkEl)\n    }\n\n    var currentUrl\n\n    if (activeInstance.props.url instanceof Array) {\n      currentUrl = activeInstance.props.url[activeInstance.state.animationIndex]\n    } else {\n      currentUrl = activeInstance.props.url\n    }\n\n    if (activeInstance.props.alertCount || activeInstance.props.renderOverlay) {\n      drawIcon({\n        alertCount: activeInstance.props.alertCount,\n        alertFillColor: activeInstance.props.alertFillColor,\n        alertTextColor: activeInstance.props.alertTextColor,\n        callback: (url) => {\n          linkEl.href = url\n        },\n        renderOverlay: activeInstance.props.renderOverlay,\n        url: currentUrl,\n      })\n    } else {\n      linkEl.href = currentUrl\n    }\n  }\n\n  static update() {\n    if (typeof document === 'undefined') return\n\n    var activeInstance = Favicon.getActiveInstance()\n    var isAnimated =\n      activeInstance.props.url instanceof Array && activeInstance.props.animated\n\n    // clear any running animations\n    var intervalId = null\n    clearInterval(activeInstance.state.animationLoop)\n\n    if (isAnimated) {\n      var animateFavicon = function animateFavicon() {\n        var nextAnimationIndex =\n          (activeInstance.state.animationIndex + 1) %\n          activeInstance.props.url.length\n        Favicon.draw()\n        activeInstance.setState({ animationIndex: nextAnimationIndex })\n      }\n      intervalId = setInterval(\n        animateFavicon,\n        activeInstance.props.animationDelay\n      )\n      animateFavicon()\n    } else {\n      Favicon.draw()\n    }\n\n    activeInstance.setState({ animationLoop: intervalId })\n  }\n\n  state = {\n    animationIndex: 0,\n    animationLoop: null,\n    animationRunning: false,\n  }\n\n  componentDidMount() {\n    Favicon.mountedInstances.push(this)\n    Favicon.update()\n  }\n\n  componentWillUnmount() {\n    var activeInstance = Favicon.getActiveInstance()\n    clearInterval(activeInstance.state.animationLoop)\n  }\n\n  componentDidUpdate(prevProps) {\n    if (\n      prevProps.url === this.props.url &&\n      prevProps.animated === this.props.animated &&\n      prevProps.alertCount === this.props.alertCount &&\n      prevProps.alertFillColor === this.props.alertFillColor &&\n      prevProps.alertTextColor === this.props.alertTextColor &&\n      prevProps.renderOverlay === this.props.renderOverlay &&\n      prevProps.keepIconLink === this.props.keepIconLink\n    )\n      return\n\n    Favicon.update()\n  }\n\n  render() {\n    return null\n  }\n}\n\nFavicon.defaultProps = {\n  alertCount: null,\n  alertFillColor: 'red',\n  alertTextColor: 'white',\n  animated: true,\n  animationDelay: 500,\n  keepIconLink: () => false,\n  renderOverlay: null,\n  url: null,\n}\n\nFavicon.propTypes = {\n  alertCount: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  alertFillColor: PropTypes.string,\n  alertTextColor: PropTypes.string,\n  animated: PropTypes.bool,\n  animationDelay: PropTypes.number,\n  keepIconLink: PropTypes.func,\n  renderOverlay: PropTypes.func,\n  url: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.string),\n    PropTypes.string,\n  ]).isRequired,\n}\n\nmodule.exports = Favicon\n"],"names":["React","require","PropTypes","CanvasSize","linkEl","drawAlert","context","fillColor","text","textColor","font","Padding","w","measureText","width","x","y","h","r","Math","min","beginPath","moveTo","arcTo","closePath","fillStyle","fill","textBaseline","textAlign","fillText","drawIcon","alertCount","alertFillColor","alertTextColor","callback","renderOverlay","src","url","img","document","createElement","crossOrigin","onload","canvas","height","getContext","clearRect","drawImage","toDataURL","Favicon","state","animationIndex","animationLoop","animationRunning","getActiveInstance","mountedInstances","length","draw","activeInstance","head","getElementsByTagName","type","rel","links","i","test","getAttribute","props","keepIconLink","removeChild","appendChild","currentUrl","Array","href","update","isAnimated","animated","intervalId","clearInterval","animateFavicon","nextAnimationIndex","setState","setInterval","animationDelay","componentDidMount","push","componentWillUnmount","componentDidUpdate","prevProps","render","Component","displayName","defaultProps","propTypes","oneOfType","number","string","bool","func","arrayOf","isRequired","module","exports"],"mappings":"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"}